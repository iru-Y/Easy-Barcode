"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateAndPrepareBuildContext = validateAndPrepareBuildContext;
const architect_1 = require("@angular-devkit/architect");
async function validateAndPrepareBuildContext(buildTargetString, context) {
    const buildTarget = await (0, architect_1.targetFromTargetString)(buildTargetString, context.target?.project, "build");
    const builderName = await context.getBuilderNameForTarget(buildTarget);
    const targetOptions = (await context.getTargetOptions(buildTarget));
    if (builderName === "@ngx-env/builder:application") {
        await context.validateOptions(targetOptions, builderName);
        const ngxEnv = targetOptions.ngxEnv;
        delete targetOptions.ngxEnv;
        context.getTargetOptions = async () => targetOptions;
        return {
            ngxEnv,
            name: builderName,
            configuration: buildTarget.configuration,
            options: targetOptions,
        };
    }
    throw new Error(`Use @ngx-env/builder:application in ${buildTarget.project}:${buildTarget.target}`);
}
//# sourceMappingURL=validate-prepare-context.js.map